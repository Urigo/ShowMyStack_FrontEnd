"use strict";var showMyStackApp=angular.module("showMyStackApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.router","ui.bootstrap","restangular","ngStorage","multi-select","checklist-model"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("main",{url:"/",controller:"MainController",templateUrl:"views/main.html",resolve:{stacks:["StacksService",function(a){return a.getAll()}],categories:["DataService",function(a){return a.getAllCategories()}]}}).state("login",{url:"/login",controller:"LoginController",templateUrl:"views/login.html"}).state("register",{url:"/register",controller:"RegisterController",templateUrl:"views/register.html"}).state("authorized",{"abstract":!0,templateUrl:"views/authrize_template.html"}).state("authorized.addStack",{url:"/addStack",controller:"AddStackController",templateUrl:"views/add_stack.html",resolve:{languages:["DataService",function(a){return a.getAllLanguages()}]}}).state("authorized.profile",{url:"/profile",controller:"ProfileController",templateUrl:"views/profile.html"}).state("authorized.logout",{url:"/logout",controller:["User","$state",function(a,b){a.clearUser(),b.go("login")}]}).state("admin",{"abstract":!0,templateUrl:"views/authrize_template.html",resolve:{languages:["DataService",function(a){return a.getAllLanguages()}],categories:["DataService",function(a){return a.getAllCategories()}],frameworks:["DataService",function(a){return a.getAllFrameworks()}]}}).state("admin.addLang",{url:"/admin/addLang",controller:"AdminController",templateUrl:"views/admin/add_lang.html"}).state("admin.addFramework",{url:"/admin/addFramework",controller:"AdminController",templateUrl:"views/admin/add_framework.html"}).state("admin.addCategory",{url:"/admin/addCategory",controller:"AdminController",templateUrl:"views/admin/add_category.html"}).state("admin.addExtension",{url:"/admin/addExtension",controller:"AdminController",templateUrl:"views/admin/add_extension.html"})}]).config(["RestangularProvider","serverUrl",function(a,b){a.setBaseUrl(b),a.addElementTransformer("users",!0,function(a){return a.addRestangularMethod("getMyProfile","get",""),a}),a.addElementTransformer("stacks",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("language",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("framework",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("category",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("extension",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("auth",!0,function(a){return a.addRestangularMethod("register","post","register"),a.addRestangularMethod("login","post","login"),a.addRestangularMethod("fbLogin","post","fbLogin"),a.addRestangularMethod("fbRegister","post","fbRegister"),a})}]).run(["Restangular","AlertsHandlerService","User",function(a,b,c){a.setErrorInterceptor(function(a){return b.addError(angular.isObject(a.data.message)&&"MongoError"===a.data.message.name?a.data.message.err:a.data.message),!1}),a.setDefaultHeaders({Authorization:"Bearer "+c.getAuthToken()})}]);showMyStackApp.constant("serverUrl","http://young-woodland-7540.herokuapp.com/"),showMyStackApp.directive("alertsPanel",["AlertsHandlerService",function(a){return{restrict:"A",replace:!0,scope:{clearOnInit:"@"},template:'<div ng-repeat="alert in alertsArray" class="alert alert-{{alert.type}} alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true" ng-click="dismissAlert($index)">&times;</button>{{alert.message}}</div>',link:function(b){angular.isDefined(b.clearOnInit)&&"true"===b.clearOnInit&&a.clearAll(),b.alertsArray=a.getAlertsArray(),b.dismissAlert=a.clear}}}]),showMyStackApp.service("AuthService",["Restangular","User",function(a,b){var c=a.all("auth");this.register=function(a){return c.register(a)},this.login=function(a){var d=c.login(a);return d.then(function(a){b.setUserFromResponse(a)}),d}}]),showMyStackApp.service("User",["$localStorage","Restangular",function(a,b){this.$storage=a,this.$storage.userDetails,this.alerts=[];var c=b.all("users");this.getAuthToken=function(){return angular.isDefined(this.$storage.userDetails)&&angular.isDefined(this.$storage.userDetails.authToken)?this.$storage.userDetails.authToken:""},this.getUserProfile=function(){return c.getMyProfile()},this.getUser=function(){return this.$storage.userDetails},this.setUserFromResponse=function(a){this.$storage.userDetails={},this.$storage.userDetails.user=a.user,this.$storage.userDetails.authToken=a.access_token,this.$storage.userDetails.isLoggedIn=!0},this.clearUser=function(){delete this.$storage.userDetails,this.$storage.userDetails},this.isAuthenticated=function(){return angular.isDefined(this.$storage.userDetails)&&null!==this.$storage.userDetails},this.getEmail=function(){return this.$storage.userDetails.user.email}}]),showMyStackApp.service("AlertsHandlerService",["$rootScope",function(a){var b=this;a.alerts=[],this.addError=function(a){b.add(a,"danger")},this.addInfo=function(a){b.add(a,"info")},this.addWarning=function(a){b.add(a,"warning")},this.addSuccess=function(a){b.add(a,"success")},this.add=function(b,c){a.alerts.push({message:b,type:c})},this.getAlertsArray=function(){return a.alerts},this.clear=function(b){a.alerts.splice(b,1)},this.clearAll=function(){a.alerts.splice(0,a.alerts.length)}}]),showMyStackApp.service("StacksService",["Restangular",function(a){var b=a.all("stacks");this.add=function(a){return b.add(a)},this.getAll=function(){return b.getAll()}}]),showMyStackApp.service("GithubService",["$resource",function(a){var b=this,c=a("https://api.github.com/:query/:user/:repo/:spec",{query:"",user:"",repo:"",spec:"",callback:"JSON_CALLBACK",per_page:100},{get:{method:"JSONP"}});this.getGitHubInfo=function(a,b){return c.get(a,b)},this.getRepoInfo=function(a,c){return angular.extend(a,{query:"repos"}),b.getGitHubInfo(a,c)}}]),showMyStackApp.service("DataService",["Restangular",function(a){var b=a.all("language"),c=a.all("framework"),d=a.all("category"),e=a.all("extension");this.addLanguage=function(a){return b.add(a)},this.addFramework=function(a){return c.add(a)},this.addCategory=function(a){return d.add(a)},this.addExtension=function(a){return e.add(a)},this.getAllLanguages=function(){return b.getAll()},this.getAllExtensions=function(){return e.getAll()},this.getAllCategories=function(){return d.getAll()},this.getAllFrameworks=function(){return c.getAll()},this.getExtensionsByFrameworkAndLanguage=function(a,b){return e.one("getByFramework",a).one("andLanguage",b).get()}}]),showMyStackApp.controller("MainController",["$scope","stacks","categories",function(a,b,c){a.stacks=b,a.categories=c,a.getCategories=function(b){var c=[],d=_.pluck(a.categories,"_id");return angular.forEach(b,function(b){var e=_.indexOf(d,b);-1!==e&&c.push(a.categories[e])}),_.pluck(c,"categoryName")}}]),showMyStackApp.controller("RegisterController",["$scope","AuthService","AlertsHandlerService",function(a,b,c){a.user={email:"",password:""},a.register=function(){c.clearAll(),b.register(a.user).then(function(){c.addSuccess("Successfully registered!")})}}]),showMyStackApp.controller("LoginController",["$scope","AuthService","AlertsHandlerService","$state",function(a,b,c,d){a.user={username:"",password:""},a.login=function(){c.clearAll(),b.login(a.user).then(function(){d.go("main")})}}]),showMyStackApp.controller("HeaderController",["$scope","User",function(a,b){a.userDetails=b.getUser()}]),showMyStackApp.controller("ProfileController",["$scope","User",function(a,b){a.userProfile={},b.getUserProfile().then(function(b){a.userProfile=b})}]),showMyStackApp.controller("AddStackController",["$scope","StacksService","GithubService","AlertsHandlerService","languages","$filter","DataService",function(a,b,c,d,e,f,g){function h(a){a.ticked=!1,a.hasOwnProperty("icon")&&(a.icon='<img class="data-image img-rounded" src="'+a.icon+'" />')}a.languages=angular.copy(e),a.$watch("languages",function(a){angular.forEach(a,function(a){a.selectedFrameworks=f("filter")(a.frameworks,{ticked:!0}),angular.forEach(a.selectedFrameworks,function(b){b.hasOwnProperty("extensions")||b.hasOwnProperty("categories")||g.getExtensionsByFrameworkAndLanguage(b._id,a._id).then(function(a){b.extensions=a.extensions,b.categories=a.categories,b.categories.push({categoryName:"All Categories",_id:""})})})})},!0),angular.forEach(a.languages,function(a){h(a),angular.forEach(a.frameworks,function(a){h(a),angular.forEach(a.versions,function(a){h(a)})})}),a.filterExtensions=function(a){return function(b){if(angular.isDefined(a)){var c=!1;return angular.forEach(a,function(a){c||(c=""===a._id?!0:-1!==_.indexOf(b.categories,a._id))}),c}return!0}},a.addStackObj={title:"",githubUrl:"",languages:[]},a.gitHubInfo=null,a.$watch("stack.githubUrl",function(b){if(angular.isDefined(b)&&""!==b){var d=/([A-Za-z0-9]+@|http(|s)\:\/\/)([A-Za-z0-9.]+)(:|\/)([A-Za-z0-9\-\/]+)(:|\/)(.*)(\.git)?/g.exec(b);null!==d&&c.getRepoInfo({user:d[5].replace("/",""),repo:d[7].replace("/","")},function(b){a.gitHubInfo=b.data})}}),a.addStack=function(){var c=f("filter")(a.languages,{ticked:!0});angular.forEach(c,function(b){var c={};c.lang=b._id,c.frameworks=[],angular.forEach(b.selectedFrameworks,function(a){var b={framework:a._id,frameworkVersion:"",extensions:[]};b.frameworkVersion=f("filter")(a.versions,{ticked:!0})[0]._id,angular.forEach(a.selectedExtensions,function(a){var c={extension:a._id,version:a.selectedVersion};b.extensions.push(c)}),c.frameworks.push(b)}),a.addStackObj.languages.push(c)}),console.log(a.addStackObj),b.add(a.addStackObj).then(function(){d.addSuccess("Stack Successfully added!")})}}]),showMyStackApp.controller("AdminController",["$scope","DataService","AlertsHandlerService","languages","frameworks","categories","$filter","GithubService",function(a,b,c,d,e,f,g,h){function i(a){a.ticked=!1,a.hasOwnProperty("icon")&&(a.icon='<img class="data-image img-rounded" src="'+a.icon+'" />')}a.languages=angular.copy(d),a.categories=angular.copy(f),a.frameworks=angular.copy(e),a.gitHubInfo=null,a.gitHubInfoTags=null,a.$watch("addExtensionObj.githubUrl",function(b){a.handleGhUrlChange(b,function(b){a.addExtensionObj.extensionName=b.name},function(b){a.addExtensionObj.versions=_.pluck(b,"name")})}),a.$watch("addFrameworkObj.githubUrl",function(b){a.handleGhUrlChange(b,function(b){a.addFrameworkObj.frameworkName=b.name},function(b){a.addFrameworkObj.versions=_.pluck(b,"name")})}),a.handleGhUrlChange=function(b,c,d){if(angular.isDefined(b)&&""!==b){var e=/([A-Za-z0-9]+@|http(|s)\:\/\/)([A-Za-z0-9.]+)(:|\/)([A-Za-z0-9\-\/]+)(:|\/)(.*)(\.git)?/g.exec(b);null!==e&&(h.getRepoInfo({user:e[5].replace("/",""),repo:e[7].replace("/","")},function(b){a.gitHubInfo=b.data,c(a.gitHubInfo)}),h.getRepoInfo({user:e[5].replace("/",""),repo:e[7].replace("/",""),spec:"tags"},function(b){a.gitHubInfoTags=b.data,d(a.gitHubInfoTags)}))}},angular.forEach(a.categories,function(a){i(a)}),angular.forEach(a.frameworks,function(a){i(a)}),angular.forEach(a.languages,function(a){i(a),angular.forEach(a.frameworks,function(a){i(a),angular.forEach(a.versions,function(a){i(a)})})}),a.addLangObj={langName:"",icon:""},a.addCategoryObj={categoryName:"",languages:[]},a.addExtensionObj={extensionName:"",githubUrl:"",versions:[],frameworks:[],categories:[]},a.addFrameworkObj={frameworkName:"",icon:"",githubUrl:"",languageId:-1,versions:[]},a.addExtensionSelectedLangId=null,a.relevateCategories=[],a.relevantFrameworks=[],a.$watch("languages",function(){var b=g("filter")(a.languages,{ticked:!0});a.addExtensionSelectedLangId=_.pluck(b,"_id")[0],a.relevateCategories=g("filter")(a.categories,function(b){return-1!==_.indexOf(b.languages,a.addExtensionSelectedLangId)}),a.relevantFrameworks=g("filter")(a.frameworks,{languageId:a.addExtensionSelectedLangId})},!0),a.addCategory=function(){var d=angular.copy(a.addCategoryObj),e=g("filter")(a.languages,{ticked:!0});d.languages=_.pluck(e,"_id"),b.addCategory(d).then(function(){c.addSuccess("Category Successfully Added!")})},a.addExtension=function(){var d=angular.copy(a.addExtensionObj);d.categories=_.pluck(g("filter")(a.relevateCategories,{ticked:!0}),"_id"),d.frameworks=_.pluck(g("filter")(a.relevantFrameworks,{ticked:!0}),"_id");var e=[];angular.forEach(d.versions,function(a){e.push({versionNumber:a,ghUrl:""})}),d.versions=e,b.addExtension(d).then(function(){c.addSuccess("Category Successfully Added!")})},a.addLang=function(){b.addLanguage(a.addLangObj).then(function(){c.addSuccess("Language Successfully Added!")})},a.addFramework=function(){var d=angular.copy(a.addFrameworkObj),e=[];angular.forEach(d.versions,function(a){e.push({versionNumber:a,ghUrl:""})}),d.versions=e,b.addFramework(d).then(function(){c.addSuccess("Framework Successfully Added!")})}}]);