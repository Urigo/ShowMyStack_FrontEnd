"use strict";var showMyStackApp=angular.module("showMyStackApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.router","ui.bootstrap","restangular","ngStorage","multi-select","checklist-model","angularjs-dropdown-multiselect","angularjs-github-url-input"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("authorized.main",{url:"/",controller:"MainController",templateUrl:"views/main.html",resolve:{stacks:["StacksService",function(a){return a.getAll()}],categories:["DataService",function(a){return a.getAllCategories()}]}}).state("error",{url:"/error",templateUrl:"views/errors/server_down.html"}).state("unauthorized",{"abstract":!0,templateUrl:"views/authorize_template.html"}).state("unauthorized.login",{url:"/login",controller:"LoginController",templateUrl:"views/login.html"}).state("unauthorized.register",{url:"/register",controller:"RegisterController",templateUrl:"views/register.html"}).state("authorized",{"abstract":!0,templateUrl:"views/authorize_template.html"}).state("authorized.addStack",{url:"/addStack",title:"Add New Stack",doActionText:"Add New Stack!",controller:"AddEditStackController",templateUrl:"views/add_edit_stack.html",resolve:{languages:["DataService",function(a){return a.getAllLanguages()}],stackInfo:[function(){return void 0}],categories:["DataService",function(a){return a.getAllCategories()}]}}).state("authorized.editStack",{url:"/editStack/:stackId",title:"Edit Existing Stack",doActionText:"Save Stack!",controller:"AddEditStackController",templateUrl:"views/add_edit_stack.html",resolve:{languages:["DataService",function(a){return a.getAllLanguages()}],stackInfo:["StacksService","$stateParams",function(a,b){return a.getById(b.stackId)}]}}).state("authorized.viewStack",{url:"/stack/:stackId",controller:"ViewStackController",templateUrl:"views/view_stack.html",resolve:{categories:["DataService",function(a){return a.getAllCategories()}],stackInfo:["StacksService","$stateParams",function(a,b){return a.getByIdFull(b.stackId)}]}}).state("authorized.profile",{url:"/profile",controller:"ProfileController",templateUrl:"views/profile.html"}).state("authorized.logout",{url:"/logout",controller:["User","$state",function(a,b){a.clearUser(),b.go("unauthorized.login")}]}).state("admin",{"abstract":!0,templateUrl:"../views/authorize_template.html",resolve:{languages:["DataService",function(a){return a.getAllLanguages()}],categories:["DataService",function(a){return a.getAllCategories()}]}}).state("admin.addLang",{url:"/admin/addLang",controller:"AdminController",templateUrl:"views/admin/add_lang.html"}).state("admin.addFramework",{url:"/admin/addFramework",controller:"AdminController",templateUrl:"views/admin/add_framework.html"}).state("admin.addCategory",{url:"/admin/addCategory",controller:"AdminController",templateUrl:"views/admin/add_category.html"}).state("admin.addExtension",{url:"/admin/addExtension",controller:"AdminController",templateUrl:"views/admin/add_extension.html"})}]).config(["RestangularProvider","serverUrl",function(a,b){a.setBaseUrl(b),a.addElementTransformer("users",!0,function(a){return a.addRestangularMethod("getMyProfile","get",""),a}),a.addElementTransformer("stacks",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("language",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("category",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("tool",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("auth",!0,function(a){return a.addRestangularMethod("register","post","register"),a.addRestangularMethod("login","post","login"),a.addRestangularMethod("fbLogin","post","fbLogin"),a.addRestangularMethod("fbRegister","post","fbRegister"),a})}]).run(["Restangular","AlertsHandlerService","User","$rootScope","$state",function(a,b,c,d,e){d.$state=e,a.setErrorInterceptor(function(a){return 0===a.status?e.go("error"):401===a.status&&-1===a.config.url.indexOf("auth/login")?e.go("unauthorized.login"):b.addError(angular.isObject(a.data.message)&&"MongoError"===a.data.message.name?a.data.message.err:a.data.message),!1}),a.addFullRequestInterceptor(function(a,b,d,e,f){c.isAuthenticated()&&(f.Authorization="Bearer "+c.getAuthToken())}),d.$on("$stateChangeError",function(a,b,c,d,e,f){console.log(f)})}]);showMyStackApp.constant("serverUrl","http://showmystack.herokuapp.com/"),showMyStackApp.directive("alertsPanel",["AlertsHandlerService",function(a){return{restrict:"A",replace:!0,scope:{clearOnInit:"@"},template:'<div ng-repeat="alert in alertsArray" class="alert alert-{{alert.type}} alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true" ng-click="dismissAlert($index)">&times;</button>{{alert.message}}</div>',link:function(b){angular.isDefined(b.clearOnInit)&&"true"===b.clearOnInit&&a.clearAll(),b.alertsArray=a.getAlertsArray(),b.dismissAlert=a.clear}}}]),showMyStackApp.directive("smartList",["$filter",function(){return{restrict:"EA",scope:{selectedModel:"=",maxSelected:"@",styles:"=",events:"=",externalModelProp:"@"},replace:!0,transclude:!0,template:'<ul ng-click="handleClickEvent($event)" class="list-group checked-list-box" ng-transclude=""></ul>',controller:["$scope",function(a){this.items=a.selectedModel||{},this.registeredItems={},this.singleSelectionMode=!1,this.styles=angular.extend({classSelected:"list-group-item-info active",classNotSelected:"",classLastClickedItem:"list-group-item-primary"},a.styles),this.events=angular.extend({initDone:angular.noop,lastClickedChanged:angular.noop,itemAddedToSelection:angular.noop,itemRemovedFromSelection:angular.noop},a.events),a.handleClickEvent=function(a){a.stopImmediatePropagation()},"1"===a.maxSelected&&(this.singleSelectionMode=!0),this.registerItem=function(a,b){this.registeredItems[a]=b},this.getRegisteredItem=function(a){return this.registeredItems[a]},this.getStyles=function(){return this.styles},this.setLastItemClicked=function(a){if(!a.nonClickable){var b=this.events.lastClickedChanged(a,this);return angular.isDefined(this.lastClickedItem)&&(this.lastClickedItem.lastClicked=!1),a.lastClicked=!0,this.lastClickedItem=a,b}},this.toggleSelectionItem=function(b){if(b.isCheckbox)if(angular.isUndefined(this.items[b.id])){if(this.events.itemAddedToSelection(b,this),this.singleSelectionMode&&angular.isDefined(this.lastSelected)&&this.toggleSelectionItem(this.lastSelected),angular.isDefined(a.externalModelProp)){var c={};c[a.externalModelProp]=b.id,this.items[b.id]=c}else this.items[b.id]=b.obj;this.lastSelected=b,b.isSelected=!0}else this.events.itemRemovedFromSelection(b,this),b.isSelected=!1,delete this.items[b.id]},this.events.initDone(this)}]}}]),showMyStackApp.directive("smartListItemHeader",[function(){return{restrict:"EA",replace:!0,scope:!1,transclude:!0,template:'<div class="row"><div ng-show="$$prevSibling.currentItem.isCheckbox" class="col-md-2 right-seperator" ng-click="$$prevSibling.toggleSelection($event)"><span class="glyphicon" ng-class="{\'glyphicon-check\': $$prevSibling.currentItem.isSelected, \'glyphicon-unchecked\': !$$prevSibling.currentItem.isSelected}"></span></div><div class="col-md-10" ng-transclude></div></div>',require:"^smartListItem",link:function(){}}}]),showMyStackApp.directive("smartListItemBody",[function(){return{restrict:"EA",replace:!0,scope:!1,transclude:!0,template:'<div ng-show="$$prevSibling.currentItem.lastClicked" class="row smart-list-item-body"><div class="col-md-12" ng-transclude></div>',require:"^smartListItem",link:function(){}}}]),showMyStackApp.directive("smartListItem",[function(){return{restrict:"EA",scope:{itemValue:"=",itemIdProp:"@",itemCheckbox:"@",nonClickable:"@",itemSelectOnClick:"@"},replace:!0,transclude:!0,template:'<li ng-click="itemClick($event)" ng-transclude class="list-group-item" ng-class="currentItem.lastClicked ? styles.classLastClickedItem : (currentItem.isSelected ? styles.classSelected : styles.classNotSelected)"></li>',require:"^smartList",controller:["$scope",function(){}],link:function(a,b,c,d){a.smartListInstance=d,a.styles=d.getStyles(),a.getItemId=function(b,c){return angular.isDefined(a.nonClickable)?"non-clickable":b.hasOwnProperty(c)?b[c]:""},a.itemClick=function(b){if(b.stopImmediatePropagation(),"form-control"!==b.originalEvent.target.classList[0]){var c=d.setLastItemClicked(a.currentItem);(angular.isUndefined(c)||c)&&a.currentItem.itemSelectOnClick&&a.toggleSelection()}},a.toggleSelection=function(b){d.toggleSelectionItem(a.currentItem),angular.isDefined(b)&&b.stopImmediatePropagation()},a.currentItem={nonClickable:angular.isDefined(a.nonClickable)?!0:!1,isCheckbox:angular.isDefined(a.itemCheckbox)?!0:!1,lastClicked:!1,isSelected:!1,itemSelectOnClick:angular.isDefined(a.itemSelectOnClick)?!0:!1,obj:a.itemValue,id:a.getItemId(a.itemValue,a.itemIdProp)},d.registerItem(a.currentItem.id,a.currentItem)}}}]),showMyStackApp.service("AuthService",["Restangular","User",function(a,b){var c=a.all("auth");this.register=function(a){return c.register(a)},this.login=function(a){var d=c.login(a);return d.then(function(a){b.setUserFromResponse(a)}),d}}]),showMyStackApp.service("User",["$localStorage","Restangular",function(a,b){this.$storage=a,this.$storage.userDetails,this.alerts=[];var c=b.all("users");this.getAuthToken=function(){return angular.isDefined(this.$storage.userDetails)&&angular.isDefined(this.$storage.userDetails.authToken)?this.$storage.userDetails.authToken:""},this.getUserProfile=function(){return c.getMyProfile()},this.getUser=function(){return this.$storage.userDetails},this.setUserFromResponse=function(a){angular.isUndefined(this.$storage.userDetails)&&(this.$storage.userDetails={}),this.$storage.userDetails.user=a.user,this.$storage.userDetails.authToken=a.access_token,this.$storage.userDetails.isLoggedIn=!0},this.clearUser=function(){delete this.$storage.userDetails,this.$storage.userDetails},this.isAuthenticated=function(){return angular.isDefined(this.$storage.userDetails)&&null!==this.$storage.userDetails},this.getEmail=function(){return this.$storage.userDetails.user.email}}]),showMyStackApp.service("AlertsHandlerService",["$rootScope",function(a){var b=this;a.alerts=[],this.addError=function(a){b.add(a,"danger")},this.addInfo=function(a){b.add(a,"info")},this.addWarning=function(a){b.add(a,"warning")},this.addSuccess=function(a){b.add(a,"success")},this.add=function(b,c){a.alerts.push({message:b,type:c})},this.getAlertsArray=function(){return a.alerts},this.clear=function(b){a.alerts.splice(b,1)},this.clearAll=function(){a.alerts.splice(0,a.alerts.length)}}]),showMyStackApp.service("StacksService",["Restangular",function(a){var b=a.all("stacks");this.add=function(a){return b.add(a)},this.edit=function(a,c){return b.customPUT(c,"edit/"+a)},this.getAll=function(){return b.getAll()},this.getById=function(a){return b.one("getById",a).get()},this.getByIdFull=function(a){return b.one("getStack",a).get()}}]),showMyStackApp.service("GithubService",["$resource",function(a){var b=this,c=a("https://api.github.com/:query/:user/:repo/:spec",{query:"",user:"",repo:"",spec:"",callback:"JSON_CALLBACK",per_page:100},{get:{method:"JSONP"}});this.getGitHubInfo=function(a,b){return c.get(a,b)},this.getRepoInfo=function(a,c){return angular.extend(a,{query:"repos"}),b.getGitHubInfo(a,c)}}]),showMyStackApp.service("DataService",["Restangular",function(a){var b=a.all("language"),c=a.all("category"),d=a.all("tool");this.addLanguage=function(a){return b.add(a)},this.addCategory=function(a){return c.add(a)},this.addTool=function(a){return d.add(a)},this.getAllLanguages=function(){return b.getAll()},this.getAllTools=function(){return d.getAll()},this.getToolsByLanguageAndCategory=function(a,b){return d.one("language",a).one("category",b).get()},this.getAllCategories=function(){return c.getAll()}}]),showMyStackApp.controller("MainController",["$scope","stacks","categories",function(a,b,c){a.stacks=b,a.categories=c,a.getCategories=function(b){var c=[],d=_.pluck(a.categories,"_id");return angular.forEach(b,function(b){var e=_.indexOf(d,b);-1!==e&&c.push(a.categories[e])}),_.pluck(c,"categoryName")}}]),showMyStackApp.controller("RegisterController",["$scope","AuthService","AlertsHandlerService",function(a,b,c){a.user={email:"",password:""},a.register=function(){c.clearAll(),b.register(a.user).then(function(){c.addSuccess("Successfully registered!")})}}]),showMyStackApp.controller("LoginController",["$scope","AuthService","AlertsHandlerService","$state",function(a,b,c,d){a.user={username:"",password:""},a.login=function(){c.clearAll(),b.login(a.user).then(function(){d.go("authorized.main")})}}]),showMyStackApp.controller("HeaderController",["$scope","User",function(a,b){a.userDetails=b.getUser()}]),showMyStackApp.controller("ProfileController",["$scope","User",function(a,b){a.userProfile={},b.getUserProfile().then(function(b){a.userProfile=b})}]),showMyStackApp.controller("AddEditStackController",["$scope","StacksService","GithubService","AlertsHandlerService","languages","$filter","DataService","$state","stackInfo","$modal","categories",function(a,b,c,d,e,f,g,h,i,j,k){a.pageTitle=h.current.title,a.buttonText=h.current.doActionText,a.categories=k,a.isEdit=!1,a.languages=e,a.selectedLanguages={},a.selectedTools={},a.tools=[],a.searchLangs="",a.toolsListStyles={classLastClickedItem:"list-group-item-info active"},a.addEditStackObj={title:"",githubUrl:"",languages:[]},a.languageListEvents={lastClickedChanged:function(b){a.onWorkLanguage=b.obj,angular.isDefined(a.onWorkCategory)&&a.loadTools()},initDone:function(b){a.langsListObj=b}},a.categoryListEvents={lastClickedChanged:function(b){a.onWorkCategory=b.obj,a.loadTools()}},a.toolsListEvents={lastClickedChanged:function(a){return!a.lastClicked},itemAddedToSelection:function(b){angular.isUndefined(a.selectedLanguages[a.onWorkLanguage._id])&&a.langsListObj.toggleSelectionItem(a.langsListObj.getRegisteredItem(a.onWorkLanguage._id)),angular.isUndefined(a.selectedLanguages[a.onWorkLanguage._id].tools)&&(a.selectedLanguages[a.onWorkLanguage._id].tools={}),a.selectedLanguages[a.onWorkLanguage._id].tools[b.id]={tool:b.id,version:null}},itemRemovedFromSelection:function(b){angular.isDefined(a.selectedLanguages[a.onWorkLanguage._id])&&delete a.selectedLanguages[a.onWorkLanguage._id].tools[b.id]}},a.loadTools=function(){g.getToolsByLanguageAndCategory(a.onWorkLanguage._id,a.onWorkCategory._id).then(function(b){a.tools=b})},angular.isDefined(i)&&(a.isEdit=!0,a.addEditStackObj.title=i.title,a.addEditStackObj.githubUrl=i.githubUrl,a.selectedLanguages=angular.copy(i.languages)),a.filterCategories=function(b){return f("filter")(b.languages,a.onWorkLanguage._id).length>0},a.addMissingCategory=function(){var b=j.open({templateUrl:"views/addMissingCategory.html",controller:"AddMissingCategoryController",resolve:{languages:function(){return a.languages}}});b.result.then(function(){})},a.AddMissingTool=function(){var b=j.open({templateUrl:"views/addMissingTool.html",controller:"AddMissingToolController",resolve:{languageId:function(){return a.onWorkLanguage._id},categories:function(){var b=f("filter")(a.categories,a.filterCategories);return b}}});b.result.then(function(){})},a.normalizeKeys=function(a){var b=[];return angular.forEach(a,function(a){b.push(a)}),b},a.addEditStack=function(){a.addEditStackObj.languages=a.normalizeKeys(a.selectedLanguages),angular.forEach(a.addEditStackObj.languages,function(b){angular.isDefined(b.tools)&&(b.tools=a.normalizeKeys(b.tools))}),a.isEdit?b.edit(i._id,a.addEditStackObj).then(function(){h.go("authorized.viewStack",{stackId:i._id})}):b.add(a.addEditStackObj).then(function(a){h.go("authorized.viewStack",{stackId:a._id})})}}]),showMyStackApp.controller("AdminController",["$scope","DataService","AlertsHandlerService","languages","frameworks","categories","$filter","GithubService",function(a,b,c,d,e,f,g,h){function i(a){a.ticked=!1,a.hasOwnProperty("icon")&&(a.icon='<img class="data-image img-rounded" src="'+a.icon+'" />')}a.languages=angular.copy(d),a.categories=angular.copy(f),a.frameworks=angular.copy(e),a.gitHubInfo=null,a.gitHubInfoTags=null,a.$watch("addExtensionObj.githubUrl",function(b){a.handleGhUrlChange(b,function(b){a.addExtensionObj.extensionName=b.name},function(b){a.addExtensionObj.versions=_.pluck(b,"name")})}),a.$watch("addFrameworkObj.githubUrl",function(b){a.handleGhUrlChange(b,function(b){a.addFrameworkObj.frameworkName=b.name},function(b){a.addFrameworkObj.versions=_.pluck(b,"name")})}),a.handleGhUrlChange=function(b,c,d){if(angular.isDefined(b)&&""!==b){var e=/([A-Za-z0-9]+@|http(|s)\:\/\/)([A-Za-z0-9.]+)(:|\/)([A-Za-z0-9\-\/]+)(:|\/)(.*)(\.git)?/g.exec(b);null!==e&&(h.getRepoInfo({user:e[5].replace("/",""),repo:e[7].replace("/","")},function(b){a.gitHubInfo=b.data,c(a.gitHubInfo)}),h.getRepoInfo({user:e[5].replace("/",""),repo:e[7].replace("/",""),spec:"tags"},function(b){a.gitHubInfoTags=b.data,d(a.gitHubInfoTags)}))}},angular.forEach(a.categories,function(a){i(a)}),angular.forEach(a.frameworks,function(a){i(a)}),angular.forEach(a.languages,function(a){i(a),angular.forEach(a.frameworks,function(a){i(a),angular.forEach(a.versions,function(a){i(a)})})}),a.addLangObj={langName:"",icon:""},a.addCategoryObj={categoryName:"",languages:[]},a.addExtensionObj={extensionName:"",githubUrl:"",versions:[],frameworks:[],categories:[]},a.addFrameworkObj={frameworkName:"",icon:"",githubUrl:"",languageId:-1,versions:[]},a.addExtensionSelectedLangId=null,a.relevateCategories=[],a.relevantFrameworks=[],a.$watch("languages",function(){var b=g("filter")(a.languages,{ticked:!0});a.addExtensionSelectedLangId=_.pluck(b,"_id")[0],a.relevateCategories=g("filter")(a.categories,function(b){return-1!==_.indexOf(b.languages,a.addExtensionSelectedLangId)}),a.relevantFrameworks=g("filter")(a.frameworks,{languageId:a.addExtensionSelectedLangId})},!0),a.addCategory=function(){var d=angular.copy(a.addCategoryObj),e=g("filter")(a.languages,{ticked:!0});d.languages=_.pluck(e,"_id"),b.addCategory(d).then(function(){c.addSuccess("Category Successfully Added!")})},a.addExtension=function(){var d=angular.copy(a.addExtensionObj);d.categories=_.pluck(g("filter")(a.relevateCategories,{ticked:!0}),"_id"),d.frameworks=_.pluck(g("filter")(a.relevantFrameworks,{ticked:!0}),"_id");var e=[];angular.forEach(d.versions,function(a){e.push({versionNumber:a,ghUrl:""})}),d.versions=e,b.addExtension(d).then(function(){c.addSuccess("Category Successfully Added!")})},a.addLang=function(){b.addLanguage(a.addLangObj).then(function(){c.addSuccess("Language Successfully Added!")})},a.addFramework=function(){var d=angular.copy(a.addFrameworkObj),e=[];angular.forEach(d.versions,function(a){e.push({versionNumber:a,ghUrl:""})}),d.versions=e,b.addFramework(d).then(function(){c.addSuccess("Framework Successfully Added!")})}}]),showMyStackApp.controller("ViewStackController",["$scope","stackInfo","categories",function(a,b,c){a.stack=b,a.categories=c,a.getCategories=function(b){var c=[],d=_.pluck(a.categories,"_id");return angular.forEach(b,function(b){var e=_.indexOf(d,b);-1!==e&&c.push(a.categories[e])}),_.pluck(c,"categoryName")}}]),showMyStackApp.controller("AddMissingToolController",["$scope","$modalInstance","GithubService","DataService","languageId","categories",function(a,b,c,d,e,f){a.categories=f,a.addToolObj={},a.selectedCategories=[],a.multiselectDropdownCatsOptions={displayProp:"categoryName",idProp:"_id",externalIdProp:"id"},a.ghModel={},a.$watch("ghModel",function(b){angular.isDefined(b.url)&&(c.getRepoInfo({user:b.username,repo:b.repo},function(b){a.addToolObj.toolName=b.data.name||""}),c.getRepoInfo({user:b.username,repo:b.repo,spec:"tags"},function(b){a.addToolObj.versions=_.pluck(b.data||[],"name")}))},!0),a.addTool=function(){var c=angular.copy(a.addToolObj);c.language=e,c.categories=_.pluck(a.selectedCategories,"id");var f=[];angular.forEach(c.versions,function(a){f.push({versionNumber:a,ghUrl:""})}),c.versions=f,d.addTool(c).then(function(a){b.close(a)})},a.cancel=function(){b.dismiss()}}]),showMyStackApp.controller("AddMissingCategoryController",["$scope","$modalInstance","DataService","languages",function(a,b,c,d){a.addCategoryObj={},a.languages=d,a.multiselectDropdownLangsOptions={displayProp:"langName",idProp:"_id",externalIdProp:"id"},a.selectedLanguages=[],a.addCategory=function(){var d=angular.copy(a.addCategoryObj);d.languages=_.pluck(a.selectedLanguages,"id"),c.addCategory(d).then(function(a){b.close(a)})},a.cancel=function(){b.dismiss()}}]);