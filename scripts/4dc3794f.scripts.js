"use strict";var showMyStackApp=angular.module("showMyStackApp",["ngCookies","ngResource","ngSanitize","ngAnimate","ngRoute","ui.router","ui.bootstrap","restangular","ngStorage","multi-select","checklist-model","angularjs-dropdown-multiselect","angularjs-github-url-input"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("error",{url:"/error",templateUrl:"views/errors/server_down.html"}).state("unauthorized",{"abstract":!0,templateUrl:"views/authorize_template.html"}).state("unauthorized.login",{url:"/login",controller:"LoginController",templateUrl:"views/login.html"}).state("unauthorized.register",{url:"/register",controller:"RegisterController",templateUrl:"views/register.html"}).state("authorized",{"abstract":!0,templateUrl:"views/authorize_template.html"}).state("authorized.stacks",{url:"/",controller:"StacksController",templateUrl:"views/stacks.html",resolve:{stacks:["StacksService",function(a){return a.getAll()}],languages:["DataService",function(a){return a.getAllLanguages()}],tools:["DataService",function(a){return a.getAllTools()}],categories:["DataService",function(a){return a.getAllCategories()}]}}).state("authorized.profile",{url:"/profile",controller:"ProfileController",templateUrl:"views/profile.html"}).state("authorized.logout",{url:"/logout",controller:["User","$state",function(a,b){a.clearUser(),b.go("unauthorized.login")}]})}]).config(["RestangularProvider","serverUrl",function(a,b){a.setBaseUrl(b),a.addElementTransformer("users",!0,function(a){return a.addRestangularMethod("getMyProfile","get",""),a}),a.addElementTransformer("stacks",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("language",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("category",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("tool",!0,function(a){return a.addRestangularMethod("add","post","add"),a.addRestangularMethod("getAll","get","all"),a}),a.addElementTransformer("auth",!0,function(a){return a.addRestangularMethod("register","post","register"),a.addRestangularMethod("login","post","login"),a.addRestangularMethod("fbLogin","post","fbLogin"),a.addRestangularMethod("fbRegister","post","fbRegister"),a})}]).run(["Restangular","AlertsHandlerService","User","$rootScope","$state",function(a,b,c,d,e){d.$state=e,a.setErrorInterceptor(function(a){return 0===a.status?e.go("error"):401===a.status&&-1===a.config.url.indexOf("auth/login")?e.go("unauthorized.login"):b.addError(angular.isObject(a.data.message)&&"MongoError"===a.data.message.name?a.data.message.err:a.data.message),!1}),a.addFullRequestInterceptor(function(a,b,d,e,f){c.isAuthenticated()&&(f.Authorization="Bearer "+c.getAuthToken())}),d.$on("$stateChangeError",function(a,b,c,d,e,f){console.log(f)})}]);showMyStackApp.constant("serverUrl","http://showmystack.herokuapp.com/"),showMyStackApp.directive("alertsPanel",["AlertsHandlerService",function(a){return{restrict:"A",replace:!0,scope:{clearOnInit:"@"},template:'<div ng-repeat="alert in alertsArray" class="alert alert-{{alert.type}} alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true" ng-click="dismissAlert($index)">&times;</button>{{alert.message}}</div>',link:function(b){angular.isDefined(b.clearOnInit)&&"true"===b.clearOnInit&&a.clearAll(),b.alertsArray=a.getAlertsArray(),b.dismissAlert=a.clear}}}]),showMyStackApp.directive("smartList",["$filter","$document","$compile",function(){return{restrict:"AE",scope:{checkedModel:"=",options:"=",extraSettings:"=",events:"="},transclude:!0,template:function(a){var b="";b+='<ul class="list-group"><li ng-show="settings.enableSearch" class="list-group-item"><input type="text" class="form-control" ng-model="searchModel" placeholder="Search..." /></li>',b+='<li class="list-group-item" ng-class="{\'list-group-item-info\': lastClickedId === getPropertyForObject(option,settings.idProp)}" data-ng-repeat="option in options | filter: searchModel"><div class="row"><div class="col-md-2" ng-show="settings.checkables" ng-click="setSelectedItem(getPropertyForObject(option,settings.idProp))" data-ng-class="{\'glyphicon glyphicon-unchecked\': !isChecked(getPropertyForObject(option,settings.idProp)),  \'glyphicon glyphicon-check\': isChecked(getPropertyForObject(option,settings.idProp))}"></div><div class="cursor-pointer" ng-class="{\'col-md-10\' : settings.checkables, \'col-md-12\': !settings.checkables, \'col-md-8\': settings.itemButtonText !== \'\' && settings.checkables, \'col-md-10\': settings.itemButtonText !== \'\' && !settings.checkables}" ng-click="itemClick(getPropertyForObject(option,settings.idProp))">{{getPropertyForObject(option, settings.displayProp)}}</div><div ng-show="settings.itemButtonText !== \'\'" class="col-md-2"><button class="btn btn-info btn-xs pull-right" ng-click="events.itemButtonAction(findFullItem(getPropertyForObject(option,settings.idProp)))">{{settings.itemButtonText}}</button></div></div><div ng-transclude></div></li>',b+="</ul>",b+="</div>",a.html(b)},link:function(a){function b(b){var c={};return""===a.settings.externalIdProp?c[a.settings.idProp]=b:c[a.settings.externalIdProp]=b,c}a.checkedModel=a.checkedModel||[],a.lastClickedId=void 0,a.eventsCallbacks={itemClicked:angular.noop,itemChecked:angular.noop,itemUnchecked:angular.noop,itemButtonAction:angular.noop},a.eventsCallbacks=angular.extend(a.eventsCallbacks,a.events||{}),a.settings={displayProp:"label",idProp:"id",externalIdProp:"id",checkables:!0,uncheckItemOnClick:!0,enableSearch:!1,itemButtonText:""},angular.extend(a.settings,a.extraSettings||[]),a.getPropertyForObject=function(a,b){return a.hasOwnProperty(b)?a[b]:""},a.findFullItem=function(b){var c={};return c[a.settings.idProp]=b,_.find(a.options,c)},a.itemClick=function(b){a.setSelectedItem(b,a.settings.uncheckItemOnClick),a.eventsCallbacks.itemClicked(a.findFullItem(b)),a.lastClickedId=b},a.setSelectedItem=function(c,d){d=d||!1;var e=b(c);if(a.settings.checkables){var f=-1!==_.findIndex(a.checkedModel,e);if(!d&&f)a.checkedModel.splice(_.findIndex(a.checkedModel,e),1);else if(!f)if(""===a.settings.externalIdProp){var g=b(c),h=_.find(a.options,g);a.checkedModel.push(h)}else a.checkedModel.push(e)}},a.getModelForObject=function(c){return _.find(a.checkedModel,b(c))},a.isChecked=function(c){return-1!==_.findIndex(a.checkedModel,b(c))?!0:!1}}}}]),showMyStackApp.service("AuthService",["Restangular","User",function(a,b){var c=a.all("auth");this.register=function(a){return c.register(a)},this.login=function(a){var d=c.login(a);return d.then(function(a){b.setUserFromResponse(a)}),d}}]),showMyStackApp.service("User",["$localStorage","Restangular",function(a,b){this.$storage=a,this.$storage.userDetails,this.alerts=[];var c=b.all("users");this.getAuthToken=function(){return angular.isDefined(this.$storage.userDetails)&&angular.isDefined(this.$storage.userDetails.authToken)?this.$storage.userDetails.authToken:""},this.getUserProfile=function(){return c.getMyProfile()},this.getUser=function(){return this.$storage.userDetails},this.setUserFromResponse=function(a){angular.isUndefined(this.$storage.userDetails)&&(this.$storage.userDetails={}),this.$storage.userDetails.user=a.user,this.$storage.userDetails.authToken=a.access_token,this.$storage.userDetails.isLoggedIn=!0},this.clearUser=function(){delete this.$storage.userDetails,this.$storage.userDetails},this.isAuthenticated=function(){return angular.isDefined(this.$storage.userDetails)&&null!==this.$storage.userDetails},this.getEmail=function(){return this.$storage.userDetails.user.email}}]),showMyStackApp.service("AlertsHandlerService",["$rootScope",function(a){var b=this;a.alerts=[],this.addError=function(a){b.add(a,"danger")},this.addInfo=function(a){b.add(a,"info")},this.addWarning=function(a){b.add(a,"warning")},this.addSuccess=function(a){b.add(a,"success")},this.add=function(b,c){a.alerts.push({message:b,type:c})},this.getAlertsArray=function(){return a.alerts},this.clear=function(b){a.alerts.splice(b,1)},this.clearAll=function(){a.alerts.splice(0,a.alerts.length)}}]),showMyStackApp.service("StacksService",["Restangular",function(a){var b=a.all("stacks");this.add=function(a){return b.add(a)},this.edit=function(a,c){return b.customPUT(c,"edit/"+a)},this.getAll=function(){return b.getAll()},this.getById=function(a){return b.one("getById",a).get()},this.getByIdFull=function(a){return b.one("getStack",a).get()}}]),showMyStackApp.service("GithubService",["$resource",function(a){var b=this,c=a("https://api.github.com/:query/:user/:repo/:spec",{query:"",user:"",repo:"",spec:"",callback:"JSON_CALLBACK",per_page:100},{get:{method:"JSONP"}});this.getGitHubInfo=function(a,b){return c.get(a,b)},this.getRepoInfo=function(a,c){return angular.extend(a,{query:"repos"}),b.getGitHubInfo(a,c)}}]),showMyStackApp.service("DataService",["Restangular",function(a){var b=a.all("language"),c=a.all("category"),d=a.all("tool");this.addLanguage=function(a){return b.add(a)},this.addCategory=function(a){return c.add(a)},this.addTool=function(a){return d.add(a)},this.getAllLanguages=function(){return b.getAll()},this.getAllTools=function(){return d.getAll()},this.getToolsByLanguageAndCategory=function(a,b){return d.one("language",a).one("category",b).get()},this.getAllCategories=function(){return c.getAll()}}]),showMyStackApp.controller("RegisterController",["$scope","AuthService","AlertsHandlerService",function(a,b,c){a.user={email:"",password:""},a.register=function(){c.clearAll(),b.register(a.user).then(function(){c.addSuccess("Successfully registered!")})}}]),showMyStackApp.controller("LoginController",["$scope","AuthService","AlertsHandlerService","$state",function(a,b,c,d){a.user={username:"",password:""},a.login=function(){c.clearAll(),b.login(a.user).then(function(){d.go("authorized.stacks")})}}]),showMyStackApp.controller("HeaderController",["$scope","User",function(a,b){a.userDetails=b.getUser()}]),showMyStackApp.controller("ProfileController",["$scope","User",function(a,b){a.userProfile={},b.getUserProfile().then(function(b){a.userProfile=b})}]),showMyStackApp.controller("StacksController",["$scope","StacksService","GithubService","AlertsHandlerService","languages","$filter","DataService","$state","$modal","categories","stacks","tools",function(a,b,c,d,e,f,g,h,i,j,k,l){a.stacks=k,a.categories=j,a.languages=e,a.tools=l,a.filteredCategories=[],a.filteredTools=[],a.selectedLang=void 0,a.selectedCat=void 0,a.checkedStacksModel=[],a.checkedLangsModel=[],a.checkedCatsModel=[],a.checkedToolsModel=[],a.stacksListSettings={idProp:"_id",displayProp:"title",externalIdProp:"",checkables:!1,enableSearch:!0},a.langsListSettings={idProp:"_id",displayProp:"langName",externalIdProp:"lang"},a.catsListSettings={idProp:"_id",displayProp:"categoryName",externalIdProp:"",checkables:!1,enableSearch:!0},a.toolsListSettings={idProp:"_id",displayProp:"toolName",externalIdProp:"tool",enableSearch:!0,itemButtonText:"i"},a.stacksListEvents={itemClicked:function(b){a.selectedStack=b,a.checkedLangsModel=a.selectedStack.languages,a.selectedCat=void 0,a.selectedLang=void 0}},a.langsListEvents={itemClicked:function(b){a.selectedLang=b;var c=f("filter")(a.selectedStack.languages,{lang:a.selectedLang._id})[0];angular.isUndefined(c.tools)&&(c.tools=[]),a.checkedToolsModel=c.tools}},a.catsListEvents={itemClicked:function(b){a.selectedCat=b}},a.toolsListEvents={itemButtonAction:function(a){i.open({templateUrl:"views/tool_info.html",controller:"ToolInfoController",resolve:{tool:function(){return a}}})}},a.rebuildFilteredCategories=function(b){var c=[];angular.forEach(a.categories,function(a){f("filter")(a.languages,b._id).length>0&&c.push(a)}),a.filteredCategories=c},a.rebuildFilteredTools=function(b,c){var d=[];angular.forEach(a.tools,function(b){var e=f("filter")(b.categories,function(a){return a===c._id});b.language===a.selectedLang._id&&e.length>0&&d.push(b)}),a.filteredTools=d},a.$watch("selectedLang",function(b){angular.isDefined(b)&&(a.rebuildFilteredCategories(b),angular.isDefined(a.selectedCat)&&a.rebuildFilteredTools(b,a.selectedCat))}),a.$watch("selectedCat",function(b){angular.isDefined(b)&&a.rebuildFilteredTools(a.selectedLang,b)}),a.addMissingCategory=function(){var b=i.open({templateUrl:"views/add_missing_category.html",controller:"AddMissingCategoryController",resolve:{languages:function(){return a.languages},languageId:function(){return a.selectedLang._id}}});b.result.then(function(b){a.categories.push(b),a.rebuildFilteredCategories(a.selectedLang)})},a.addMissingTool=function(){var b=i.open({templateUrl:"views/add_missing_tool.html",controller:"AddMissingToolController",resolve:{languageId:function(){return a.selectedLang._id},categoryId:function(){return a.selectedCat._id},categories:function(){return a.categories}}});b.result.then(function(b){a.tools.push(b),a.rebuildFilteredTools(a.selectedLang,a.selectedCat)})},a.addNewStack=function(){var b=i.open({templateUrl:"views/add_stack.html",controller:"AddStackController"});b.result.then(function(b){a.stacks.push(b)})},a.getToolsCount=function(a){var b=0;return angular.forEach(a,function(a){angular.isDefined(a.tools)&&(b+=a.tools.length)}),b},a.saveStack=function(){var c=angular.copy(a.selectedStack);delete c._id,delete c.createdBy,delete c.updatedBy,delete c.createdAt,delete c.updatedAt,delete c.__v,b.edit(a.selectedStack._id,c).then(function(){d.addSuccess('Stack "'+c.title+'" Successfully Updated!')})}}]),showMyStackApp.controller("AdminController",["$scope","DataService","AlertsHandlerService","languages","frameworks","categories","$filter","GithubService",function(a,b,c,d,e,f,g,h){function i(a){a.ticked=!1,a.hasOwnProperty("icon")&&(a.icon='<img class="data-image img-rounded" src="'+a.icon+'" />')}a.languages=angular.copy(d),a.categories=angular.copy(f),a.frameworks=angular.copy(e),a.gitHubInfo=null,a.gitHubInfoTags=null,a.$watch("addExtensionObj.githubUrl",function(b){a.handleGhUrlChange(b,function(b){a.addExtensionObj.extensionName=b.name},function(b){a.addExtensionObj.versions=_.pluck(b,"name")})}),a.$watch("addFrameworkObj.githubUrl",function(b){a.handleGhUrlChange(b,function(b){a.addFrameworkObj.frameworkName=b.name},function(b){a.addFrameworkObj.versions=_.pluck(b,"name")})}),a.handleGhUrlChange=function(b,c,d){if(angular.isDefined(b)&&""!==b){var e=/([A-Za-z0-9]+@|http(|s)\:\/\/)([A-Za-z0-9.]+)(:|\/)([A-Za-z0-9\-\/]+)(:|\/)(.*)(\.git)?/g.exec(b);null!==e&&(h.getRepoInfo({user:e[5].replace("/",""),repo:e[7].replace("/","")},function(b){a.gitHubInfo=b.data,c(a.gitHubInfo)}),h.getRepoInfo({user:e[5].replace("/",""),repo:e[7].replace("/",""),spec:"tags"},function(b){a.gitHubInfoTags=b.data,d(a.gitHubInfoTags)}))}},angular.forEach(a.categories,function(a){i(a)}),angular.forEach(a.frameworks,function(a){i(a)}),angular.forEach(a.languages,function(a){i(a),angular.forEach(a.frameworks,function(a){i(a),angular.forEach(a.versions,function(a){i(a)})})}),a.addLangObj={langName:"",icon:""},a.addCategoryObj={categoryName:"",languages:[]},a.addExtensionObj={extensionName:"",githubUrl:"",versions:[],frameworks:[],categories:[]},a.addFrameworkObj={frameworkName:"",icon:"",githubUrl:"",languageId:-1,versions:[]},a.addExtensionSelectedLangId=null,a.relevateCategories=[],a.relevantFrameworks=[],a.$watch("languages",function(){var b=g("filter")(a.languages,{ticked:!0});a.addExtensionSelectedLangId=_.pluck(b,"_id")[0],a.relevateCategories=g("filter")(a.categories,function(b){return-1!==_.indexOf(b.languages,a.addExtensionSelectedLangId)}),a.relevantFrameworks=g("filter")(a.frameworks,{languageId:a.addExtensionSelectedLangId})},!0),a.addCategory=function(){var d=angular.copy(a.addCategoryObj),e=g("filter")(a.languages,{ticked:!0});d.languages=_.pluck(e,"_id"),b.addCategory(d).then(function(){c.addSuccess("Category Successfully Added!")})},a.addExtension=function(){var d=angular.copy(a.addExtensionObj);d.categories=_.pluck(g("filter")(a.relevateCategories,{ticked:!0}),"_id"),d.frameworks=_.pluck(g("filter")(a.relevantFrameworks,{ticked:!0}),"_id");var e=[];angular.forEach(d.versions,function(a){e.push({versionNumber:a,ghUrl:""})}),d.versions=e,b.addExtension(d).then(function(){c.addSuccess("Category Successfully Added!")})},a.addLang=function(){b.addLanguage(a.addLangObj).then(function(){c.addSuccess("Language Successfully Added!")})},a.addFramework=function(){var d=angular.copy(a.addFrameworkObj),e=[];angular.forEach(d.versions,function(a){e.push({versionNumber:a,ghUrl:""})}),d.versions=e,b.addFramework(d).then(function(){c.addSuccess("Framework Successfully Added!")})}}]),showMyStackApp.controller("AddMissingToolController",["$scope","$modalInstance","GithubService","DataService","languageId","categories","categoryId",function(a,b,c,d,e,f,g){a.categories=f,a.addToolObj={},a.selectedCategories=[{id:g}],a.multiselectDropdownCatsOptions={displayProp:"categoryName",idProp:"_id",externalIdProp:"id"},a.ghModel={},a.$watch("ghModel",function(b){angular.isDefined(b.url)&&(c.getRepoInfo({user:b.username,repo:b.repo},function(b){a.addToolObj.toolName=b.data.name||""}),c.getRepoInfo({user:b.username,repo:b.repo,spec:"tags"},function(b){a.addToolObj.versions=_.pluck(b.data||[],"name")}))},!0),a.addTool=function(){var c=angular.copy(a.addToolObj);c.language=e,c.categories=_.pluck(a.selectedCategories,"id");var f=[];angular.forEach(c.versions,function(a){f.push({versionNumber:a,ghUrl:""})}),c.versions=f,d.addTool(c).then(function(a){b.close(a)})},a.cancel=function(){b.dismiss()}}]),showMyStackApp.controller("AddMissingCategoryController",["$scope","$modalInstance","DataService","languages","languageId",function(a,b,c,d,e){a.addCategoryObj={},a.languages=d,a.multiselectDropdownLangsOptions={displayProp:"langName",idProp:"_id",externalIdProp:"id"},a.selectedLanguages=[{id:e}],a.addCategory=function(){var d=angular.copy(a.addCategoryObj);d.languages=_.pluck(a.selectedLanguages,"id"),c.addCategory(d).then(function(a){b.close(a)})},a.cancel=function(){b.dismiss()}}]),showMyStackApp.controller("AddStackController",["$scope","$modalInstance","GithubService","StacksService",function(a,b,c,d){a.addStackObj={},a.ghModel={},a.$watch("ghModel",function(a){angular.isDefined(a.url)&&c.getRepoInfo({user:a.username,repo:a.repo},function(){})},!0),a.addStack=function(){d.add(a.addStackObj).then(function(a){b.close(a)})},a.cancel=function(){b.dismiss()}}]),showMyStackApp.controller("ToolInfoController",["$scope","$modalInstance","tool",function(a,b,c){a.tool=c,a.cancel=function(){b.dismiss()}}]);